<script src="/lib/js/jquery.js"></script>
<script src="/lib/js/raphael.js"></script>
<link rel="stylesheet" href="lib/css/eight.css">


<html>
  <head>
	<script>
	(function($) {
		var eight = {
		
			config: {
				container: ".wrapper",
				size: 30,
				multiplier: 120,
				
				color: {
					nyu: "#57068c",
					cu: "#c4d8e2",
					new: "#FF1300"
				},
				
				people : [
					{	name: "anders",
						gender: "M",
						school: "CU",
						x: 1,
						y: 1
					},
					{	
						name: "beth",
						gender: "F",
						school: "CU",
						x: 2,
						y: 1
					},
					{	
						name: "claire",
						gender: "F",
						school: "NYU",
						x: 1,
						y: 2
					},
					{	
						name: "daniel",
						gender: "M",
						school: "NYU",
						x: 2,
						y: 2
					},
					{	
						name: "everett",
						gender: "M",
						school: "New",
						x: 1,
						y: 3
					},
					{	
						name: "fiona",
						gender: "F",
						school: "NYU",
						x: 2,
						y: 3
					},
				]
			},
		
			init: function() {
				vertical = [];
				horizon = [];
				woman = [];
				man = [];
				eight.container = $(eight.config.container);
				paper = Raphael(50, 50, 1500, 1500);
				eight.size = eight.config.size;
				eight.multiplier = eight.config.multiplier;
				
				var graph = eight.assignMethods();
				graph.setup();
				
				$("a").click( function(e) {
					e.preventDefault();
					var graph = eight.assignMethods($(this).attr("class"));
					graph.sortBy();
				})
			},
		
			assignMethods : function(trigger) {
				function create() {
					var number = eight.config.people.length;
					paper.width = paper.width;
					var moreView = false;
			 	    
					for (var i = 0; i < number; i++) {
						var currentPerson = eight.config.people[i];
						var nextPerson = eight.config.people[i+1];
						var nextTwo = eight.config.people[i+2];
						var name = currentPerson.name;
						var school = currentPerson.school;
					
						// account for 0
						var adj = number - 1;
						var adj2 = adj - 1; 
						
						var curX = currentPerson.x * eight.multiplier;
						var curY = currentPerson.y * eight.multiplier;
						
						// except for the last person
						if (i !== adj ) {
							var nextX = nextPerson.x * eight.multiplier;
							var nextY = nextPerson.y * eight.multiplier;
						}
						// generate horizontals
						if (i < adj2) {
							var nextTwoX = nextTwo.x * eight.multiplier;
							var nextTwoY = nextTwo.y * eight.multiplier;
						}
						
						
						var center = eight.size/2;
						
						
						// define women
						if (currentPerson.gender == "F") { 
					    woman.push( paper.circle(curX+eight.size/2, curY+eight.size/2, eight.size/2)
					         .attr({fill: "white", stroke: "#000"})
					         .data({"name": name, "school": school})
					         .hover(function () {
					            $(".name").text(this.data("name"));
					         }) );
						 }
						 else {
							 woman.push(null);
						 }
						 
						 
						 // define men
						if (currentPerson.gender == "M") {
 	 					 man.push( paper.rect(curX, curY, eight.size, eight.size)
 	 					 	.attr({fill: "none", stroke: "#000"})
 	 					 	.data({"name": name, "school": school})
 	 					 	.hover(function () {
 	 					 	    $(".name").text(this.data("name"));
 	 					 	}) );
						}
				 		else {
				 			 man.push(null);
				 		}

					
						
						//draw vertical line (always skip 2)
						if (i < 4) {
							vertical.push( paper.path(["M", curX + center, curY + center*2, "L", nextTwoX + center, nextTwoY])
							.data("id", "vRel" + i) );
						}
						
						//draw horizontal line to next opposite gender
						if (i !== adj) {
						 	if (nextPerson.gender !== currentPerson.gender) {
						 		horizon.push( paper.path(["M", curX + center*2, curY + center, "L", nextX, nextY + center])
								.data("id", "hRel" + i) );
							}
							// account for empty spaces in array
							else {
								horizon.push(null);
							}
						}	
					}
				};
				
				
				function relDuration(path) {
					if (path) {
						switch (path.data("id")) {
						//b to d
					  	case "vRel1":
							path.attr({"stroke-linejoin": "miter", "stroke-dasharray": ". "})
					   		break;
						//d to f
				  		case "vRel3":
				  			path.attr({"stroke-width": 10})
				  			break;
						// a to b
				 		case "hRel0":
							path.attr({"stroke-width": 10})
				    		break;
						// c to d
			  			case "hRel2":
			  				path.attr({"stroke-width": 10})
			  			 	break;
						// e to f
			  			case "hRel4":
			  				path.attr({"stroke-linejoin": "miter", "stroke-dasharray": "- "})
			  				break;
						default:
						  	path.attr({"stroke-width":1})
						}
					}	
				};
				
				function relOKC(path) {
					if (path) {
						switch (path.data("id")) {
						//b to d
					  	case "vRel1":
							path.attr({stroke: "red"})
					   		break;
						//d to f
				  		case "vRel0":
				  			path.attr({stroke: "red"})
				  			break;
						// c to d
			  			case "hRel2":
			  				path.attr({stroke: "red"})
			  			 	break;
						// e to f
			  			case "hRel4":
			  				path.attr({stroke: "red"})
			  				break;
						default:
						  	path.attr({stroke: "black"})
						}
					}	
				};
				
				function setSchool(element) {			 
					if (element != null) {
						if (element.data("school") == "NYU") {
							element.attr({fill: eight.config.color.nyu});
						}
						else if (element.data("school") == "CU") {
							element.attr({fill: eight.config.color.cu});
						}
						else {
							element.attr({fill: eight.config.color.new});
						}
					}
				};
				
				
				function sortPaths() {
					var number = eight.config.people.length;
				
					for (var i = 0; i < number; i++) {
						
						
						if (trigger == "duration") {
							relDuration(horizon[i]);
							relDuration(vertical[i]);
						}
						else if (trigger == "okcupid") {
							relOKC(horizon[i]);
							relOKC(vertical[i]);
						}
						else if (trigger == "school") {
							setSchool(woman[i]);
							setSchool(man[i]);
						}
						
						
					}
				};

			
				return {
					setup: function() {
						create();
					},
					sortBy: function() {
						sortPaths();
					}
				
				
				}
			}
		}
	
		$(document).ready( function() {
			eight.init();
		});

	
	})(jQuery);

	</script>
 
 

  </head>

  <body>
	  
	  <header>
	  	<div class="name">the person's name!</div>
	  	<a class="okcupid" href="#">okCupid</a>
		<a class="duration" href="#">duration</a>
		<a class="school" href="#">school</a>
	  </header>

</body>
</html>


